name: å½­å½­ä¸¹ä¸“å±å½±é™¢ä¸ªæ€§åŒ–

permissions:
  contents: write

on:
  schedule:
    - cron: "0 5 * * *" # åœ¨åŒæ­¥å1å°æ—¶æ‰§è¡Œä¸ªæ€§åŒ–
  workflow_dispatch:
  workflow_run:
    workflows: ["Upstream Sync"]
    types:
      - completed

jobs:
  personalize_for_pengpengdan:
    name: ğŸ’ ä¸ºå½­å½­ä¸¹å®šåˆ¶ä¸“å±å½±é™¢
    runs-on: ubuntu-latest
    if: ${{ github.event.repository.fork }}

    steps:
      - name: ğŸ’– æ£€å‡ºä»“åº“
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: ğŸ¬ ä¸ªæ€§åŒ–ä¸ºå½­å½­ä¸¹çš„ä¸“å±å½±é™¢
        run: |
          echo "ğŸ’ å¼€å§‹ä¸ºå½­å½­ä¸¹å®šåˆ¶ä¸“å±å½±é™¢..."

          # ç¡®ä¿è„šæœ¬ç›®å½•å­˜åœ¨
          mkdir -p scripts

          # è¿è¡Œä¸ªæ€§åŒ–è„šæœ¬
          node scripts/personalize.js

          echo "âœ¨ ä¸ªæ€§åŒ–å®Œæˆï¼å·²ä¸ºå½­å½­ä¸¹å®šåˆ¶ä¸“å±å½±é™¢"

      - name: ğŸ’• æäº¤ä¸ªæ€§åŒ–æ›´æ”¹
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "å½­å½­ä¸¹ä¸“å±æœºå™¨äºº"
          
          if [[ -n $(git status --porcelain) ]]; then
            git add .
            git commit -m "ğŸ’– ä¸ºå½­å½­ä¸¹å®šåˆ¶ä¸“å±å½±é™¢ - $(date '+%Y-%m-%d %H:%M:%S')"
            git push
            echo "ğŸ’ ä¸ªæ€§åŒ–æ›´æ”¹å·²æäº¤å¹¶æ¨é€"
          else
            echo "ğŸ’« æ²¡æœ‰éœ€è¦æäº¤çš„æ›´æ”¹"
          fi

      - name: ğŸ‰ å®Œæˆé€šçŸ¥
        run: |
          echo "ğŸ¬âœ¨ å½­å½­ä¸¹çš„ä¸“å±å½±é™¢å·²å‡†å¤‡å°±ç»ªï¼"
          echo "ğŸ’– æ‰€æœ‰LibreTVæ ‡è¯†å·²æ›¿æ¢ä¸ºå……æ»¡çˆ±æ„çš„ä¸ªæ€§åŒ–å†…å®¹"
          echo "ğŸŒŸ äº«å—ä½ çš„ä¸“å±è§‚å½±æ—¶å…‰å§ï¼"
